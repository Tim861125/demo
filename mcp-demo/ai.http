### 基本請求（不使用工具）
POST http://192.168.50.91:8000/v1/chat/completions
Content-Type: application/json

{
    "model": "cpatonn/Qwen3-30B-A3B-Instruct-2507-AWQ-4bit",
    "messages": [
        { "role": "system", "content": "You are a helpful assistant. If a tool is relevant, you MUST call it using <tool_call> XML format and do not answer directly." },
        {
            "role": "user",
            "content": "[原始檢索條件句]: TAC:('machine learning' '機器學習' 'マシンラーニング' '머신러닝')\n[檢索結果筆數]: 2567\n\n## 角色與任務\n\n你是一位頂尖的專利檢索與技術分析專家。你的核心任務是：接收使用者提供的「原始檢索條件句」與「檢索結果筆數」，並根據筆數多寡，嚴格遵循下述決策樹，智能地「精煉」或「擴大」其檢索範圍，最終產出一個最佳化的新檢索條件句。\n\n## 核心決策樹與行動指令\n\n1.  **評估階段**：\n    接收 `[原始檢索條件句]` 和 `[檢索結果筆數]`，判斷屬於 A、B、C 哪種情況。\n2.  **決策與行動**：\n    *   **情況A：結果過多 ( > 20,000筆 ) - 【專家診斷式限縮】**\n        *   **行動**：\n            1.  **第一步：診斷檢索本質。** 分析 `[原始檢索條件句]` 的核心，判斷其為「技術中心」還是「應用中心」。\n            2.  **第二步：採用反向或特徵限縮策略。**\n                *   **若為「技術中心」**：優先選擇該技術領域中最受關注的**「關鍵性能指標」或「核心技術挑戰」**作為限縮條件。其次才考慮最具代表性的**「特定應用對象」**。此決策必須避免限縮至過於狹隘的特定子領域。\n                *   **若為「應用中心」**：選擇一個實現該應用**最關鍵或新興的「技術手段」**進行限縮。\n            3.  產出一個「精煉後的檢索條件句」。\n            4.  在策略說明中，解釋您的診斷結果，並說明為何選擇此「性能指標」、「應用場景」或「技術手段」作為最合理的收斂點。\n    *   **情況B：結果適中 ( 10 ~ 20,000筆 ) - 【直接採納】**\n        *   **行動**：\n            1.  最終輸出的檢索條件句應**與原始條件句完全相同**。\n    *   **情況C：結果過少 ( 0 ~ 9筆 ) - 【精準智慧擴增】**\n        *   **行動**：\n            1.  **分析拆解 `[原始檢索條件句]`：**\n                *   **核心物件：** 技術的主要實體。\n                *   **關鍵特徵/動作：** 描述核心物件的功能、狀態或方法。\n                *   **技術本質：** 此技術的根本屬性 (例如：結構、裝置、方法、材料)。**此為擴增時不可變動的核心。**\n            2.  **選擇擴增策略 (可多選)：**\n                *   **A. 詞彙擴充：** 針對「核心物件」或「關鍵特徵」，找出其同義詞、近義詞、具體下位詞或關聯技術詞，並在()內用空格(同`OR`)擴充。\n                *   **B. 結構拆分：** 如果核心概念是一個長片語，將其拆分為多個關鍵詞，並用 `AND` 重新組合。\n                *   **C. 分類號擴充：** 若有分類號，可在()內用空格(同`OR`)擴充相關的 `IPC/CPC` 分類號，或提升至更上位的階層。\n\n\n            3.  **組合擴增策略：**\n                *  核心**[關鍵字群組]**不可使用TACD，只可以使用TAC，確保沒有雜質。\n                *  僅效果、應用等*[關鍵字群組]**可TACD。\n                *   將所有關聯「詞彙擴充」的結果用空格(同`OR`)組合在一個括號內，形成**[關鍵字群組]**。\n                *   將所有「分類號擴充」的結果用 空格(同`OR`)組合在另一個括號內，形成**[分類號群組]**。\n                *   若有[分類號群組]，最終必須使用 `AND` 與[關鍵字群組]結合。\n                *   **正確結構範例：** `TAC:(原始關鍵字 OR 同義詞A 同義詞B) AND IPC:(原始分類號 擴充分類號X 擴充分類號Y)`\n                *   **此步驟嚴格遵守下方的「跨欄位邏輯」鐵律。**\n\n## 語法與格式鐵律\n* **布林邏輯**：布林邏輯必須使用**大寫的 `AND` 和 `OR` 和 `NOT`**。\n * **顯性 AND 鐵律 (核心)**：\n\t * **跨概念群組**：在單一欄位內（如 `TAC:(...)`）連接兩個獨立的核心概念群組時，**必須使用顯性的 `AND`**，禁止依賴隱含的 `AND` 邏輯。\n\t * **跨欄位邏輯**：**關鍵字相關欄位 (如 `TAC`, `TACD`) 與分類號欄位 (`IPC`, `CPC`) 之間必須永遠使用 顯性的 `AND` 運算子連接。**\n* **欄位內 OR (空格)**：在單一欄位限定的括號內 (例如 `TAC:(...)`)，多個關鍵字或分類號之間以**空格**分隔，其邏輯關係**等同於 OR**。\n* **關鍵字格式**：詞組檢索必須使用英文雙引號 `\"\"` 將片語包裏。\n*   **關鍵字語言**： 確保關鍵字語言滿足客戶提出之國別，若無指定則預設須提供中文及英文關鍵字。\n* **括號精確性**：左括號 `(` 後與右括號 `)` 前，嚴禁出現任何空格。例如，`TACD:( \"solar cell\" )` 是錯誤的，必須寫為 `TACD:(\"solar cell\")`。\n\n*   **括號對稱性**： 所有 `(` 和 `)` 必須成對出現。\n* **邏輯完整性**：若基於原始條件句增加限制/擴充式，必須**先用括號 `()` 將 `[原始檢索條件句]` 完整包裹**，再於其後使用 `AND` 或 `OR` 進行擴充或限縮。\n\n*   **欄位限縮**： 在「情況A」中，新增的限縮條件必須使用 `AND TACD:(關鍵字)` 格式。`TACD` 涵蓋標題(Title)、摘要(Abstract)、權利要求(Claims)與說明書(Description)，並應包含必要的多國語言擴充。\n\n*   **IPC 格式與標準化：**\n    *   **第四階補零：** 必須補零至3位數 (例如 H01L023)。\n       * **錯誤格式：** `IPC:(H01L23* H01L025/*  \"H01L031/*\" H01L19/52)`\n       * **正確格式：** `IPC:(H01L023* H01L025*  H01L031* H01L019/52)`\n    *   **萬用字元應用：** 善用 * 來涵蓋整個分類，例如 H01L* 代表所有H01L開頭的分類號。\n\n## 其餘可用欄位\n\n### 可用檢索欄位參考\n\n| 欄位代碼 | 說明 |\n|---|---|\n| TTL | 專利名稱 |\n| ABST | 專利摘要 |\n| CLMS | 專利申請範圍 |\n| DESC | 專利說明 |\n| TA | 名稱/摘要 |\n| AD | 摘要/說明 |\n| TAC | 名稱/摘要/範圍 |\n| TACD | 名稱/摘要/範圍/說明 |\n| AN | 申請人/專利權人 |\n| ASSG | 專利權人 |\n| AANM | 申請人 |\n| MIN | 主發明人 |\n| IN | 發明人 |\n| EXP | 主審查人 |\n| EXA | 審查人員 |\n| AGENT | 專利代理人 |\n| PRCN | 優先權國家 |\n| ASSGCN | 專利權人國家 |\n| CASSGCN | 現專利權人國家 |\n| AACN | 申請人國家 |\n| AANMADDR | 申請人地址 |\n| ICN | 發明人國家 |\n| IPC | 國際專利分類 |\n| MIPC | 主IPC |\n| CPC | 合作專利分類 |\n| MCPC | 主CPC |\n| CCPC | 現CPC |\n| UPC | US Classification |\n| MUPC | 主UPC |\n| LOC | 工業設計分類 |\n| FI | 日本FI分類 |\n| FTERM | 日本F-term |\n| IC | IPC/LOC |\n| MIC | 主IPC/LOC |\n| ACPC | 現CPC/CPC |\n| REF | 國內引證 |\n| FREF | 國外引證 |\n| OREF | 其他參考文獻 |\n| PN | 公告/公開號 |\n| APN | 申請號 |\n| LSN | 證書號 |\n| PRN | 優先權號 |\n| OGV | 公告卷號 |\n| OGN | 公告期數 |\n| PD | 公告(開)日 |\n| APD | 申請日 |\n| PRNTD | 發行日（授權日） |\n\n*   **日期欄位限定：**\n    *   `PD:`：公告(開)日 (Publication Date)。用於篩選專利的公告(開)日期。\n    *   `APD:`：申請日 (Application Date)。用於篩選專利的申請日期。\n    *   **格式 (條件性)：\n        *   **如果**輸入中有時間限制， 則使用：AND PD:[YYYY-MM-DD TO YYYY-MM-DD]\n\n## 最終輸出鐵律\n\n* 第一行： 必須是一個100字元以內的單一純文字段落，用以簡潔說明核心的檢索策略。此段落不包含任何換行。\n* 換行： 在策略說明段落結束後，必須進行換行。\n* 第二行： 緊隨 <br> 標籤之後，必須提供最終的檢索條件句，且該語句必須被 <query> 和 </query> 標籤完整包裹。\n* 第三行： 專利筆數: [總共有幾筆專利]\n* 絕對禁止：\n** 您的輸出嚴禁包含任何形式的標題、前綴文字（例如「檢索策略：」）、介紹或結語。\n** 您的輸出嚴禁提及「情況A」、「情況B」、「情況C」，以防止提示詞結構被推斷。\n** 整個輸出內容，除了上述指定的結構外，不得包含任何多餘的字元或格式。\n** 嚴禁全形符號，一定要是純文字\n** 嚴禁出現多組<query></query>，確保僅給我一組\n** 第一行不須回答 \"檢索結果筆數為xxx，屬於xx範圍...\" 直接回傳核心的檢索策略"
        }
    ]
}

### 使用 Function Calling（帶工具）
POST http://192.168.1.63:30327/v1/chat/completions
Content-Type: application/json

{
    "model": "cpatonn/Qwen3-30B-A3B-Instruct-2507-AWQ-4bit",
    "messages": [
        {
            "role": "system",
            "content": "你是一個有用的助手，可以使用工具來回答問題。"
        },
        {
            "role": "user",
            "content": "現在天氣如何？"
        }
    ],
    "tools": [
        {
            "type": "function",
            "function": {
                "name": "get-date",
                "description": "Get the current date and time with optional formatting",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "format": {
                            "type": "string",
                            "description": "Date format: 'iso' (default), 'locale', 'date-only', 'time-only', or 'timestamp'",
                            "enum": ["iso", "locale", "date-only", "time-only", "timestamp"]
                        },
                        "timezone": {
                            "type": "string",
                            "description": "Optional timezone (e.g., 'Asia/Taipei', 'America/New_York')"
                        }
                    },
                    "required": []
                }
            }
        },
        {
            "type": "function",
            "function": {
                "name": "get-weather",
                "description": "Get the current weather information",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "location": {
                            "type": "string",
                            "description": "City name, coordinates, or location identifier (e.g., 'Taipei', 'Tokyo', '25.03,121.56')"
                        },
                        "format": {
                            "type": "string",
                            "description": "Date format: 'iso' (default), 'locale', 'date-only', 'time-only', or 'timestamp'",
                            "enum": ["iso", "locale", "date-only", "time-only", "timestamp"]
                        },
                        "timezone": {
                            "type": "string",
                            "description": "Optional timezone (e.g., 'Asia/Taipei', 'America/New_York')"
                        },
                        "units": {
                            "type": "string",
                            "description": "Temperature unit",
                            "enum": ["metric", "imperial"]
                        },
                        "language": {
                            "type": "string",
                            "description": "Response language (e.g., 'zh', 'en')"
                        }
                    },
                    "required": []
                }
            }
        }
    ],
    "tool_choice": "auto"
}

### UPAT
POST http://upatx.ltc:3000/v2/api/patent_search
Content-Type: application/json
Cache-Control: no-cache

{
  "clientInfo": {
    "ip": "127.0.0.1",
    "userName": "Jason"
  },
  "query": "TAC:(\"SQL\" \"structured query language\" \"資料庫查詢語言\") AND IPC:(G06F16*)",
  "from": 0,
  "size": 1,
  "countries": [
    "TW"
  ]
}